<!--
	TurtleSheet
	Peter Burkimsher 2016-10-27
	
	Railway:
		Limited Express data to confirm stations in red
	
	To Do:
		Object-oriented design. Every time the pen is picked up and put down, a new object is created.
		Saving multiple "files" into LocalStorage.
		Compile subroutines in Logo code (to cube ...end).
		Draggable turtle, objects.
		Onclick scripts.
		Animation, save gif.
		Multiple turtles.
		Setsh to change the turtle icon.
		Line colour, width.
		Fill area.
		Object awareness - don't draw a label over something else.
		Diagonal selection in spreadsheet.
		Jump turtle to new coordinates.
-->

<!DOCTYPE html>
<html>
<head>
	<title>TurtleSheet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="leaflet.ie.css" /><![endif]-->

	<style>

		body {
		font-family: Helvetica;
		}

		li {
			list-style: none;
		}
		li:before {
			content: "✓ ";
		}

		input {
			border: none;
			width: 80px;
			font-size: 14px;
			padding: 2px;
		}

		input:hover {
			background-color: #eee;
		}

		input:focus {
			background-color: #ccf;
		}

		input:not(:focus) {
			text-align: right;
		}

		table {
			border-collapse: collapse;  
		}

		td {
			border: 1px solid #999;
			padding: 0;
		}

		tr:first-child td, td:first-child {
			background-color: #ccc;
			padding: 1px 3px;
			font-weight: bold;
			text-align: center;
		}

		footer {
			font-size: 80%;
		}

	</style>
	<style>
		.labelClass{
			white-space:nowrap;
			text-align:center;
			border-radius:0%;
			color: black
		}
		
		.leaflet-container {
    		background-color:rgba(255,0,0,0.0);
		}
	</style>
</head>
<body>
	
	<!-- External scripts -->
	<script src="leaflet/leaflet.js"></script>
	<!--<script src="leaflet051.js"></script>-->
	
	<!-- Rotated marker from https://github.com/bbecquet/Leaflet.RotatedMarker-->
	<script src="leaflet.rotatedMarker.js"></script> 

	<!-- Semicircle from https://github.com/jieter/Leaflet-semicircle -->
	<script src="Semicircle.js"></script> 

	<!-- Leaflet to PNG-->
	<script src="leaflet-image.js"></script> 
		
	<!-- Actual HTML layout -->

	
	<h2>
		TurtleSheet
	</h2>
	
	Peter Burkimsher 2016-10-26
	<br>
		• Lost? See the <a href="readMe.html">Read Me</a>
	</br>
	
	<p>
	</p>
	
	
	<table>
		<tr>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				Import Area
			</td>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				Spreadsheet
			</td>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				Drawing
			</td>
		</tr>
		<tr>
			<td style="background-color:#FFFFFF;border: none;">
				<textarea id="importArea" rows="34" cols="10"></textarea>
			</td>
			<td style="background-color:#FFFFFF;border: none;">
				<div style="overflow-y: scroll; height:450px; overflow-x: scroll; width:510px;">
					<table id="spreadsheet" style=""></table>
				</div>
			</td>
			<td style="background-color:#FFFFFF;">
				<div id="drawing" style="width: 640px; height: 480px; float: right;"></div>
			</td>
			<td style="background-color:#FFFFFF;border: none;">
				<div id="images"></div>
			</td>
			<td style="background-color:#FFFFFF;border: none;">
				<table id="objects" style="display:none"></table>
			</td>
		</tr>
	</table>
	
	<table>
		<tr>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="importSheet();">
				Import
			</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;display:none"
			onclick="leafletImage(drawing, doImage);">
				Export
			</td>
		</tr>

	</table>
	
	<table>
		<tr>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="clearSpreadsheet();">
				Clear
			</td>
		</tr>
		<tr>
		<td style="display:none">
			<input id="numberRowsField"></input>
		</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;display:none"
			onclick="setRows();">
				Rows
			</td>
		</tr>
		<td style="display:none">
			<input id="numberColumnsField"></input>
		</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;display:none"
			onclick="setColumns();">
				Columns
			</td>
		</tr>
	</table>

	<br></br>

	<table>
		<tr>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				Logo Code
			</td>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				
			</td>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				JavaScript code
			</td>
		</tr>
		<tr>
			<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;">
				<textarea id="logoCodeArea" rows="10" cols="40"></textarea>
			</td>
			<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;">
				<table>
					<tr>
						<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;" onclick="compile(logoCodeArea.value, '');">
							<img src="images/SECompileScriptImage.png">
						</td>
						<td style="border: none;background-color: #FFFFFF; font-weight: normal;" onclick="compile(logoCodeArea.value, '');">
							Compile
						</td>
					</tr>
					<tr>
						<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;" onclick="load();" onclick="load();">
							<img src="images/SEBundleContentsClosedImage.png">
						</td>
						<td style="border: none;">
							Load
						</td>
					</tr>
					<tr>
						<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;" onclick="save();" onclick="save();">
							<img src="images/floppy_disk.png">
						</td>
						<td style="border: none;">
							Save
						</td>
					</tr>
				</table>
			</td>
			<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;">
				<textarea id="jsCodeArea" rows="10" cols="40"></textarea>
			</td>
			<td style="background-color: #FFFFFF;border: 0px solid #FFFFFF;" onclick="run();">
				<img src="images/SERunScriptImage.png">
			</td>
			<td style="border: none;" onclick="run();">
				Run
			</td>
		</tr>
	</table>
	
	<table>
		<tr>
			<td style="background-color:#FFFFFF;border: none;text-align: left;">
				Shortcuts
			</td>
		</tr>
		<tr>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="lt(90);">
				lt 90
			</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="fd(50);">
				fd 50
			</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="rt(90);">
				rt 90
			</td>
		</tr>
		<tr>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="cg();">
				cg
			</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="square();">
				square
			</td>
			<td style="width:100px;height:20px;background-color:#44C4C4;text-align:center;"
			onclick="railway();">
				railway
			</td>
		</tr>
	</table>


	<!-- Setup scripts -->

	<script>
	
		// addObject - Add a new object to the list on the right
		function addObject(objectType, objectName)
		{
			// Add the objects to the object table
			objectTable = document.getElementById("objects");

			// Create an empty <tr> element and add it to the last position of the table
			//numberObjects = drawingObjects.length;
			objectRow = objectTable.insertRow(numberObjects);

			// Insert new cells (<td> elements) into the last row
			objectCell = objectRow.insertCell(0);
			objectCell.innerHTML = objectType;
			objectCell = objectRow.insertCell(1);
			objectCell.innerHTML = objectName;
			
			// Save the object name in an array
			objectNames.push(objectName);
			
			numberObjects = numberObjects + 1;
			
		} // end function addObject

		// pd - Pen down. Start a new line. 
		function pd() 
		{
			penIsUp = false;
			
			// Reset the line array
			lineArray = new Array();
			var turtleLatitude = turtle.getLatLng().lat;
			var turtleLongitude = turtle.getLatLng().lng;
			var turtleLatLng = new L.LatLng(turtleLatitude, turtleLongitude);			

			lineArray.push(turtleLatLng);

			// Support multiple lines
			currentLineArray = currentLineArray + 1;
			allLinesArrays.push(lineArray);

			currentLineObject = numberObjects - 1;
			lineObject = new L.polyline(allLinesArrays[currentLineArray], {color: 'black',weight: 1,opacity: 1,smoothFactor: 1});
    	
			drawing.addLayer(lineObject);
		
		
			// The lines and labels are all in one array of drawing objects
			drawingObjects.push(lineObject);
			
			// Add the line to the list on the right
			addObject("Line", "Untitled");
			
			
		} // end function pd
		
		// dashedLine - Start drawing a dashed line. 
		function dashedLine() 
		{
			penIsUp = false;
			
			// Reset the line array
			lineArray = new Array();
			var turtleLatitude = turtle.getLatLng().lat;
			var turtleLongitude = turtle.getLatLng().lng;
			var turtleLatLng = new L.LatLng(turtleLatitude, turtleLongitude);			

			lineArray.push(turtleLatLng);

			// Support multiple lines
			currentLineArray = currentLineArray + 1;
			allLinesArrays.push(lineArray);

			currentLineObject = numberObjects - 1;
			lineObject = new L.polyline(allLinesArrays[currentLineArray], {color: '#d9701f',weight: 1,opacity: 1,dashArray: '10,10',smoothFactor: 1});
    	
			drawing.addLayer(lineObject);
		
		
			// The lines and labels are all in one array of drawing objects
			drawingObjects.push(lineObject);
			
			// Add the line to the list on the right
			addObject("DashedLine", "Untitled");
			
			
		} // end function dashedLine		

		function globalVariables()
		{
			var drawing;
			var turtle;
			var penIsUp;
			var lineArray;
			var currentLineArray;
			var allLinesArrays;
			var currentLineObject;
			var drawingObjects;
			var numberObjects;
			var objectTable;
			var objectNames;
			
		} // end function globalVariables
	
		// Leaflet drawing area
		function initialiseLeaflet()
		{

			var zoomLevel = 10;
			
			drawing = new L.Map("drawing",{
				center: [0, 0],
				zoom: zoomLevel,
				zoomControl:true,
				crs: L.CRS.Simple
			});

			drawing.setZoom(2);


			drawing.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.

			// The turtle
								
			var TurtleIcon = L.Icon.extend({
				options: {
					iconSize:     [32, 32],
					iconAnchor:   [16, 20],
					popupAnchor:  [0, 0]
				}
			});
		
			var thisTurtleIcon = new TurtleIcon({iconUrl: 'images/turtle.png'});

			turtle = L.marker([0,0], {icon: thisTurtleIcon,rotationOrigin: '16px 20px', rotationAngle: 0, opacity: 1}).addTo(drawing);

			// Whether the pen is up or down
			penIsUp = false;

			// The line
			lineArray = new Array();
		
			//lineArray.push([0, 0]);

			// Support multiple lines
			currentLineArray = 0;
			allLinesArrays = new Array();
			allLinesArrays.push(lineArray);

			currentLineObject = 0;
			var lineObject = new L.polyline(allLinesArrays[currentLineArray], {color: 'black',weight: 1,opacity: 1,smoothFactor: 1});
		
			drawing.addLayer(lineObject);
				
			// The lines and labels are all in one array of drawing objects
			drawingObjects = new Array();
				
			drawingObjects.push(lineObject);
		
			numberObjects = 1;
		
			// Add the objects to the object table
			objectTable = document.getElementById("objects");

			// Insert new cells (<td> elements) into the last row
			var objectRow = objectTable.insertRow(0);
			var objectCell = objectRow.insertCell(0);
			objectCell.innerHTML = "Object";
			objectCell = objectRow.insertCell(1);
			objectCell.innerHTML = "Name";
		
			objectNames = new Array();
		
			pd();
		} // end function initialiseLeaflet

		// resizeDrawing - Re-initialise Leaflet with a new map size
		function resizeDrawing(newWidth, newHeight)
		{
			// Resize the drawing area
			var drawingArea = document.getElementById("drawing");
			drawingArea.style.width = newWidth;
			drawingArea.style.height = newHeight;
			
			drawing.remove();
			
			initialiseLeaflet();

		} // end function resizeDrawing

		
		// Run the initialiseLeaflet function first
		globalVariables();
		initialiseLeaflet();
		
	</script>
	

	<script>
		// Spreadsheet from http://jsfiddle.net/ondras/hYfN3/
		
		var localStorageColumns = localStorage["numberColumns"];
		var localStorageRows = localStorage["numberRows"];
		
		if (localStorageColumns == null)
		{
			var numberColumns = 5;
		} else {
			var numberColumns = localStorageColumns;
		}
		
		if (localStorageRows == null)
		{
			var numberRows = 10;
		} else {
			var numberRows = localStorageRows;
		}
		
		buildSpreadsheet(numberColumns, numberRows);
		
		function buildSpreadsheet(numberColumns, numberRows)
		{
			// Erase a previous spreadsheet
			document.getElementById("spreadsheet").innerHTML = "";
			
			// Write the number of rows and columns to the interface
			document.getElementById("numberRowsField").value = numberRows;
			document.getElementById("numberColumnsField").value = numberColumns;
			
			// For every row, build the spreadsheet one column at a time
			for (var currentRow = 0; currentRow <= numberRows; currentRow++) 
			{
				var row = document.getElementById("spreadsheet").insertRow(-1);
			
				for (var currentColumn=0; currentColumn <= numberColumns; currentColumn++) 
				{
					var columnName = String.fromCharCode("A".charCodeAt(0)+currentColumn-1);
					row.insertCell(-1).innerHTML = currentRow&&currentColumn ? "<input id='"+ columnName+currentRow +"'/>" : currentRow||columnName;
				}
			} // end for building the spreadsheet

			var DATA={};
			var INPUTS=[].slice.call(document.getElementById("spreadsheet").querySelectorAll("input"));
		
			INPUTS.forEach(
				function(elm) {
					elm.onfocus = function(e) 
					{
						e.target.value = localStorage[e.target.id] || "";
					};
		   
					elm.onblur = function(e) 
					{
						localStorage[e.target.id] = e.target.value;
						computeAll();
					};
		   
					var getter = function() 
					{
						var value = localStorage[elm.id] || "";
						if (value.charAt(0) == "=") 
						{
							with (DATA) return eval(value.substring(1));
						} else { 
							return isNaN(parseFloat(value)) ? value : parseFloat(value); 
						}
					};
		   
					Object.defineProperty(DATA, elm.id, {get:getter});
					Object.defineProperty(DATA, elm.id.toLowerCase(), {get:getter});
		   
				} // end function elm
			);
			(
				window.computeAll = function() 
				{
					INPUTS.forEach(
					function(elm) 
					{ 
						try 
						{ 
							elm.value = DATA[elm.id]; 
						} catch(e) 
						{
							// Don't do anything if no data is found
						} 
					});
				}
			)();
		} // end function buildSpreadsheet
		
		function textBetween(thisText, startString, endString)
		{
			var start_pos = 0;
			if (startString != 'start')
			{
				start_pos = thisText.indexOf(startString);
						
				// If the text does not contain the start string, return a blank string
				if (start_pos < 0)
				{
					return '';
				}
						
				// Skip the first startString characters
				start_pos = start_pos + startString.length;
			}
					
					
			var end_pos = thisText.length;
			if (endString != 'end')
			{
				end_pos = thisText.indexOf(endString,start_pos);
			}
					
			// If the text does not have the end string after the start string, return the whole string after the start
			if (end_pos < start_pos)
			{
				end_pos = thisText.length;
			}
					
			var newText = thisText.substring(start_pos,end_pos);
					
			return newText;
		} // end textBetween
		
		// contains - Does thisText contain searchString?
		function contains(thisText, searchString)
		{
			if (thisText == null)
			{
				return false;
			}
			
			return thisText.indexOf(searchString) != -1;
		} // end function contains
		
	</script>
	
	
	<!-- Interface event scripts -->
	<script>
	
		// importSheet - Read tab-delimited text from importArea and put it into the spreadsheet
		function importSheet()
		{
			// Read the text
			var importText = importArea.value;
			
			importText=importText.split(/\r?\n/);
			
			var numberRows = importText.length;
			
			for (var currentRow = 1; currentRow <= numberRows; currentRow++) 
			{
			
				var thisRow = importText[currentRow-1];
				
				thisRow = thisRow.split(/\t/);
				
				var numberColumns = thisRow.length;
							
				for (var currentColumn=1; currentColumn <= numberColumns; currentColumn++) 
				{
					var thisCell = thisRow[currentColumn-1];
					
					
					var columnName = String.fromCharCode("A".charCodeAt(0)+currentColumn-1);

					localStorage[columnName+currentRow] = thisCell;
				} // end for every column on this row
			
			} // end for every row
			
			// Reload the spreadsheet
			computeAll();
			
		} // end function importSheet
	
	
		// Clear the spreadsheet
		function clearSpreadsheet()
		{
			for (var currentRow = 0; currentRow <= numberRows; currentRow++) 
			{
				var row = document.getElementById("spreadsheet").insertRow(-1);
			
				for (var currentColumn=0; currentColumn <= numberColumns; currentColumn++) 
				{
					var columnName = String.fromCharCode("A".charCodeAt(0)+currentColumn-1);
					
					localStorage[columnName+currentRow] = "";
				}
			} // end for building the spreadsheet
			
			computeAll();
		} // end function clearSpreadsheet
		
		// Set the number of rows in the spreadsheet
		function setRows()
		{
			// Read the value from the interface
			var newNumberRows = document.getElementById("numberRowsField").value;
			
			// If there is a new number of rows entered
			if (newNumberRows != "")
			{
				numberRows = newNumberRows;
			}
			
			// Save the new value to local storage
			localStorage["numberRows"] = numberRows;
			
			// Rebuild the spreadsheet
			buildSpreadsheet(numberColumns, numberRows);
		} // end function setRows

		// Set the number of rows in the spreadsheet
		function setColumns()
		{
			// Read the value from the interface
			var newNumberColumns = document.getElementById("numberColumnsField").value;
			
			// If there is a new number of rows entered
			if (newNumberColumns != "")
			{
				numberColumns = newNumberColumns;
			}
			
			// Save the new value to local storage
			localStorage["numberColumns"] = numberColumns;
			
			// Rebuild the spreadsheet
			buildSpreadsheet(numberColumns, numberRows);
		} // end function setRows

		// doImage - Read a PNG onto a canvas
		function doImage(err, canvas) 
		{
				
			var img = document.createElement('img');
			var dimensions = drawing.getSize();
			img.width = dimensions.x;
			img.height = dimensions.y;
			img.src = canvas.toDataURL();
			document.getElementById('images').innerHTML = '';
			document.getElementById('images').appendChild(img);
		} // end function doImage		
		
		// Compile Logo code to JavaScript
		function compile(logoCode, indent)
		{			
			logoCode=logoCode.split(/\r?\n/);
			
			var numberLines = logoCode.length;
			
			// For every line in the code
			for (var currentLine = 0; currentLine < numberLines; currentLine++) 
			{
				// Get the line
				var thisLine = logoCode[currentLine];
				
				// Split the command and the data
				var thisCommand = textBetween(thisLine, "start", " ");
				var thisData = textBetween(thisLine, " ", "end");
				
				// If this line contains square brackets, compile it differently
				if (contains(thisData, "["))
				{				
					// If this is a repeat loop
					if (contains(thisCommand,"repeat"))
					{
						compileRepeat(thisData);
					} // end if repeat
					
					// If this is a label command
					if (contains(thisCommand,"label"))
					{					
						thisData = textBetween(thisData, "[", "]");
						
						jsLine = indent + thisCommand + "(\"" + thisData + "\");\n";
						appendJsCode(jsLine);
					
					} // end if label
					
				} else {
				
					// Build the JavaScript line
					var jsLine = indent;
					jsLine = jsLine + thisCommand;
					jsLine = jsLine + "(";
					
					// If this data is not blank
					if (thisData != "")
					{
						jsLine = jsLine + "\"";
						jsLine = jsLine + thisData;
						jsLine = jsLine + "\"";
					} // end if thisData is not blank
					
					jsLine = jsLine + ")";
					jsLine = jsLine + ";";
					jsLine = jsLine + "\n";
				
					// Append the line to the JavaScript code
					appendJsCode(jsLine);
				}  // end if this line contains square brackets
				
			} // end for every line
						
		} // end function compile
		
		
		// compileRepeat - make a loop and execute it
		function compileRepeat(parameters)
		{
			var numberTimes = textBetween(parameters, "start", " ");
			
			var jsLine;
			
			jsLine = "var numberTimes = " + numberTimes + ";\n";
			appendJsCode(jsLine);

			jsLine = "for (currentTime = 0; currentTime < numberTimes; currentTime++)\n";
			appendJsCode(jsLine);

			jsLine = "{\n";
			appendJsCode(jsLine);

			var subCode = textBetween(parameters, "[", "]");
			subCode=subCode.split(/ /);

			var numberCommands = subCode.length;
			
			// For every command in the repeat loop
			for (currentCommand = 0; currentCommand < numberCommands; currentCommand = currentCommand + 2)
			{
				var thisCommand = subCode[currentCommand];
				var thisData = subCode[currentCommand+1];
				
				compile(thisCommand + " " + thisData, "	");
				
			} // end for every command

			jsLine = "}\n";
			appendJsCode(jsLine);
			
		} // end function compileRepeat
		
		// load - Load Logo Code from the localStorage
		function load()
		{
			var logoCode = localStorage["logoCode"];
			
			document.getElementById("logoCodeArea").value = logoCode;
		} // end function load
		
		// save - Save Logo Code to the localStorage
		function save()
		{
			var logoCode = document.getElementById("logoCodeArea").value;
						
			localStorage["logoCode"] = logoCode;
		} // end function save
		
		// Append code to the JS text area
		function appendJsCode(thisLine)
		{
			var jsCode = jsCodeArea.value;
			jsCode = jsCode + thisLine;
			jsCodeArea.value = jsCode;
		} // end appendJsCode
		
		// Run the JavaScript in the editor
		function run() 
		{
    		return eval(jsCodeArea.value);
		} // end function run

		// Check if a value is a number
		function isNumeric(n) 
		{
			return !isNaN(parseFloat(n)) && isFinite(n);
		} // end function isNumeric

		// Calculate the sin of a number of degrees
		function sinDegrees(angle) 
		{
			return Math.sin(angle/180*Math.PI);
		} // end function sinDegrees

		// Calculate the cos of a number of degrees
		function cosDegrees(angle) 
		{
			return Math.cos(angle/180*Math.PI);
		} // end function cosDegrees

		// Repeat - make a loop and execute it
		function repeat(numberTimes, thisCode)
		{
			// For number of times to do the loop
			for (currentTime = 0; currentTime < numberTimes; currentTime++)
			{
    			eval(thisCode);
			} // end for number of times
		} // end function repeat
		


	</script>

	<!-- LogoWriter features -->
	<script>

		// rt - synonym for right
		function rt(degrees) { right(degrees); }

		// Turn right
		function right(degrees)
		{
			var oldAngle = turtle.options.rotationAngle;
						
			// If it's not a number, it's probably a cell, so try to read it from local storage
			if (isNumeric(degrees) == false)
			{			
				degrees = localStorage[degrees];
			} else {
				// If it is numeric, multiply it by 1 just to make sure. This caused problems with quoted integers before. 
				degrees = degrees * 1;
			} // end if not numeric
			
			var newAngle = oldAngle + degrees;
			
			if (newAngle >= 360)
			{
				newAngle = newAngle - 360;
			}
			
			if (newAngle < 0)
			{
				newAngle = newAngle + 360;
			}
			turtle.setRotationAngle(newAngle);
			
		} // end function right

		// Turn left
		function left(degrees)
		{
			degrees = degrees * -1;
			right(degrees);
		} // end function left

		// lt - synonym for left
		function lt(degrees) { left(degrees); }
		
		// Go forward
		// To do: teach the turtle how to calculate geometry for non-right angles
		function forward(steps)
		{
			var oldLatitude = turtle.getLatLng().lat;
			var oldLongitude = turtle.getLatLng().lng;
			
			var angle = turtle.options.rotationAngle;
			
			var newLatitude = oldLatitude;
			var newLongitude = oldLongitude;
						
			// If it's not a number, it's probably a cell, so try to read it from local storage
			if (isNumeric(steps) == false)
			{			
				steps = localStorage[steps];
			} else {
				// If it is numeric, multiply it by 1 just to make sure. This caused problems with quoted integers before. 
				steps = steps * 1;
			} // end if not numeric
			
			// Right angles are easy, and using a switch statement is good for educational purposes
			switch (angle)
			{
				case 0:
					newLatitude = newLatitude + steps; break;
				case 90:
					newLongitude = newLongitude + steps; break;
				case 180:
					newLatitude = newLatitude - steps; break;
				case 270:
					newLongitude = newLongitude - steps; break;
				default:
					// Calculate geometry. sohcahtoa!
					var hypotenuse = steps;
										
					var opposite = sinDegrees(angle) * hypotenuse;;
					var adjacent = cosDegrees(angle) * hypotenuse;
					
					newLongitude = newLongitude + opposite;
					newLatitude = newLatitude + adjacent;

					break;
			} // end switch right angles
			
			// Move the turtle
			var newLatLng = new L.LatLng(newLatitude, newLongitude);			
			turtle.setLatLng(newLatLng);
			
			// If the pen is down, add the new point to the current line
			if (penIsUp == false)
			{
				// Draw the line
				allLinesArrays[currentLineArray].push([newLatitude, newLongitude]);
				drawingObjects[currentLineObject].addLatLng([newLatitude, newLongitude]);
			
    			drawingObjects[currentLineObject].redraw();
    		} // end if pen is up
    		
		} // end function forward
		
		// fd - synonym for forward
		function fd(degrees) { forward(degrees); }
		
		// back - move the turtle back
		function back(steps)
		{
			// Run forward with a negative number
			forward(-1 * steps);
		} // end function bk


		// bk - synonym for back
		function bk(steps) { back(steps); }

		// ht - Hide the turtle
		function ht() 
		{ 
			turtle.setOpacity(0);
		} // end function ht

		// st - Show the turtle
		function st() 
		{ 
			turtle.setOpacity(1);
		} // end function st

		// cg - Clear graphics
		function cg() 
		{
			// Move the turtle back to the centre and make it visible
			var newLatLng = new L.LatLng(0, 0);
			turtle.setLatLng(newLatLng);
			turtle.setRotationAngle(0);
			turtle.setOpacity(1);
			
			// Remove all markers
			for(currentLayer in drawingObjects) 
			{
				try 
            	{
            		drawing.removeLayer(drawingObjects[currentLayer]);
           		} catch(e) {
               		alert("problem with " + e + drawing._layers[i]);
           		} // end try to remove layer
    		} // end for every layer
			
			// Reset the line array
			lineArray = new Array();
			lineArray.push([0, 0]);

			// Support multiple lines
			currentLineArray = 0;
			allLinesArrays = new Array();
			allLinesArrays.push(lineArray);

			currentLineObject = 0;
			lineObject = new L.polyline(allLinesArrays[currentLineArray], {color: 'black',weight: 1,opacity: 0.5,smoothFactor: 1});
    	
			drawing.addLayer(lineObject);
		
		
			// The lines and labels are all in one array of drawing objects
			drawingObjects = new Array();
		
			drawingObjects.push(lineObject);
    		
		} // end function cg

		// pu - Pen up. Stop adding points to the current line. 
		function pu() 
		{
			penIsUp = true;
						
		} // end function pu	

		// Circle
		function circle(circleColour)
		{
			var coordinates = turtle.getLatLng();
			var radius = 1;
			
			if (circleColour == null)
			{
				circleColour = "#FFFFFF";
			}
			
			var circleObject = new L.circle(coordinates, radius, {color: "#000000", fillColor:circleColour, fillOpacity: 1, weight: 1});
			
			drawing.addLayer(circleObject);
			
			addObject("Circle", "Untitled");
			
			// Add the label to drawing objects, so it can be cleared
			drawingObjects.push(circleObject);

		} // end function circle

		// semicircle
		function semicircle(circleColour, thisStartAngle, thisStopAngle)
		{
			var coordinates = turtle.getLatLng();
			var radius = 1;
			
			if (circleColour == null)
			{
				circleColour = "#FFFFFF";
			}
			
			var circleObject = new L.circle(coordinates, radius, {color: "#000000", fillColor:circleColour, fillOpacity: 1, weight: 1, startAngle: thisStartAngle, stopAngle: thisStopAngle});
			
			drawing.addLayer(circleObject);
			
			addObject("Semicircle", "Untitled");
			
			// Add the label to drawing objects, so it can be cleared
			drawingObjects.push(circleObject);

		} // end function semicircle

		// function halfCircleTop - A shortcut for a semicircle
		function halfCircleTop(circleColour)
		{
			semicircle(circleColour, -90, 90);
		} // end function halfCircleTop

		// function halfCircleBottom - A shortcut for a semicircle
		function halfCircleBottom(circleColour)
		{
			semicircle(circleColour, 90, 270);
		} // end function halfCircleBottom

		// function thirdCircleRight - A shortcut for a semicircle
		function thirdCircleRight(circleColour)
		{
			semicircle(circleColour, 0, 120);
		} // end function thirdCircleRight

		// function thirdCircleBottom - A shortcut for a semicircle
		function thirdCircleBottom(circleColour)
		{
			semicircle(circleColour, 120, 240);
		} // end function thirdCircleBottom

		// function thirdCircleLeft - A shortcut for a semicircle
		function thirdCircleLeft(circleColour)
		{
			semicircle(circleColour, 240, 360);
		} // end function thirdCircleLeft


		// createLabelIcon
		function createLabelIcon(labelText)
		{
			return L.divIcon(
			{
				className: "labelClass",
				html: labelText
			});
		} // end function createLabelIcon

		// label - Add a text label at the current position
		function label(thisText)
		{
		
			var markerLatLng = turtle.getLatLng();
			
			var turtleLatitude = markerLatLng.lat;
			var turtleLongitude = markerLatLng.lng;
			
			var angle = turtle.options.rotationAngle;
			
			var markerLatitude = turtleLatitude;
			var markerLongitude = turtleLongitude;
			
			var markerLatLng = new L.LatLng(markerLatitude, markerLongitude);
			
			var labelRotation=0;
			var textAlign = "left";
			
			// Right angles are easy, and using a switch statement is good for educational purposes
			switch (angle)
			{
				case 0:
					labelRotation=0;
					textAlign = "left";
					break;
				case 90:
					labelRotation=90;
					textAlign = "top";
					break;
				case 180:
					//labelRotation=180;
					
					// Reading text upside down is hard
					labelRotation=0;
					textAlign = "right";
					break;
				case 270:
					labelRotation=270;
					textAlign = "bottom";
					break;
				default:
					labelRotation=angle;
					textAlign = "left";
					break;
			} // end switch right angles
				
			
			var labelHtml = "<div id='thisLabel' style='transform: rotate("+labelRotation+"deg); -webkit-transform: rotate("+labelRotation+"deg);float:"+textAlign+"; '>" + thisText + "</div>";

			// Add the label first, then move it based on the width.
			var thisLabel = L.marker(markerLatLng, {icon:createLabelIcon(labelHtml)});
			
			// Add the label to drawing objects, so it can be cleared
			drawingObjects.push(thisLabel);
			
			// Add the label to the drawing
			thisLabel.addTo(drawing);
			
			addObject("Label",thisText);
			
			var test = document.getElementById("thisLabel");
			var labelWidth = test.clientWidth;
			var labelHeight = test.clientHeight;
        	var turtleWidth = 8;
        	
        	// Set the id to something unique, like the label text
        	test.setAttribute("id", thisText);
						
			var offset = 3;
						
			// Right angles are easy, and using a switch statement is good for educational purposes
			
			switch (angle)
			{
				case 0:
					//markerLatitude = markerLatitude + offset;
					markerLongitude = markerLongitude + offset;
					break;
				case 90:
					markerLatitude = markerLatitude - offset;
					//markerLongitude = markerLongitude + offset;
					break;
				case 180:
					//markerLatitude = markerLatitude - offset;
					markerLongitude = markerLongitude - offset;
					break;
				case 270:
					markerLatitude = markerLatitude + (offset * 1.5);
					//markerLongitude = markerLongitude - offset;
					break;
				default:
					// Calculate geometry. sohcahtoa!
					var hypotenuse = offset;
										
					var opposite = sinDegrees(angle) * hypotenuse;
					var adjacent = cosDegrees(angle) * hypotenuse;
					
					markerLongitude = markerLongitude + opposite;
					markerLatitude = markerLatitude + adjacent;

					break;
			} // end switch right angles
			
			
			// Move the label						
			markerLatLng = new L.LatLng(markerLatitude, markerLongitude);
			
			thisLabel.setLatLng(markerLatLng);
			
			
			
			//var thisCircle = L.circleMarker(markerLatLng, { fillColor: "#FFFFFF", radius: 6 } ).bindLabel("hello world", { noHide: true, opacity: 0.7, direction: 'right', offset: [-280, -32] }).addTo(drawing);
		} // end function label
		
		// jump - Move the turtle to new coordinates without drawing a line
		function jump(newLatitude, newLongitude)
		{
			// Lift the pen up
			pu();
			
			// Move the turtle
			var newLatLng = new L.LatLng(newLatitude, newLongitude);			
			turtle.setLatLng(newLatLng);
			
			// Put the pen down
			pd();
		} // end function jump

	</script>
	
	
	<!-- Drawings. These should normally be user-generated, but here are some examples. -->
	<script>
		// square
		function square()
		{

			for (currentSide = 0; currentSide < 4; currentSide++)
			{
				fd(50);
				rt(90);
			} // end for each side
		
		} // end function square

		// cube - from the original!
		function cube()
		{
			square();
			fd(50);
			rt(45);
			fd(25);
			rt(45);
			fd(50);
			rt(180);
			lt(45);
			fd(25);
			lt(45);
			fd(50);
			rt(180);
			rt(45);
			fd(25);
			lt(45);
			fd(50);
		} // end function cube
		
		
		// Taiwan railway
		function railway()
		{
				
			importArea.value = "label(\"Badu 八堵\");halfCircleTop(\"#d91820\");halfCircleBottom(\"#000000\");\nlt(90);\nfd(3);\nlabel(\"Sankeng 三坑\");\ncircle();\nfd(5);\nlabel(\"Keelung 基隆\");circle(\"#d91820\");\nbk(8);\nrt(90);\n4\nlabel(\"Qidu 七堵\");circle(\"#d91820\");\n4\nBaifu 百福\n4\nWudu 五堵\n3\nlabel(\"Xizhi 汐止\");circle(\"#d91820\");\n2\ncircle();fd(1);label(\"Xike 汐科\");fd(5);\nlabel(\"Nangang 南港 <font color='#da5530'>HSR 高鐵</font> <font color='#1896dc'>MRT 捷運</font>\");thirdCircleRight(\"#f9bd93\");thirdCircleBottom(\"#1896dc\");thirdCircleLeft(\"#d91820\");\n5\nlabel(\"Songshan 松山 <font color='#1896dc'>MRT 捷運</font>\");halfCircleTop(\"#1896dc\");halfCircleBottom(\"#d91820\");\nfd(7);\nlabel(\"<b>Taipei 臺北</b> <font color='#da5530'>HSR 高鐵</font> <font color='#1896dc'>MRT 捷運</font>\");\nfd(1);\nthirdCircleRight(\"#f9bd93\");thirdCircleBottom(\"#1896dc\");thirdCircleLeft(\"#d91820\");\nfd(3);\nlabel(\"<font color='#1896dc'>(Longshan Temple MRT 龍山寺站捷運)</font>\");\nfd(2);\nhalfCircleTop(\"#1896dc\");halfCircleBottom(\"#d91820\");\nfd(1);\nlabel(\"Wanhua 萬華\");\nfd(5);\nlabel(\"Banqiao 板橋 <font color='#da5530'>HSR 高鐵</font> <font color='#1896dc'>MRT 捷運</font>\");thirdCircleRight(\"#f9bd93\");thirdCircleBottom(\"#1896dc\");thirdCircleLeft(\"#d91820\");\n3\nFuzhou 浮洲\n20\nlabel(\"Shulin 樹林\");circle(\"#d91820\");\n4\nSouth Shulin 南樹林\n4\nShanjia 山佳\n5\nlabel(\"Yingge 鶯歌\");circle(\"#d91820\");\n10\nlt(90);\npu();\ndashedLine();\nfd(10);\nlt(90);\nfd(9);\nrt(90);\nfd(10);\nrt(90);\nfd(20);\ncircle(\"#f9bd93\");\npu();\nbk(20);\nlt(90);\nbk(10);\nlt(90);\nbk(9);\nrt(90);\nbk(10);\npd();\nrt(90);\nlabel(\"Taoyuan 桃園\");circle(\"#d91820\");\n6\nNeili 內壢\n5\nlt(90);\npu();\ndashedLine();\nfd(20);\nlt(180);\ncircle(\"#f9bd93\");\npu();\nbk(2);\npd();\nlabel(\"<font color='#da5530'>Taoyuan HSR 桃園高鐵</font>\");\npu();\nfd(2);\nrt(180);\nbk(20);\nrt(90);\npd();\nlabel(\"Zhonglì 中壢\");circle(\"#d91820\");\n6\nPuxin 埔心\nfd(2);\nlt(90);\nfd(3);\nlabel(\"Yangmei 楊梅\");circle(\"#d91820\");\n6\nFugang 富岡\n5\nBaihwu 北湖\n4\nlabel(\"Hukou 湖口\");circle(\"#d91820\");\n6\nlabel(\"Xinfeng 新豐\");circle(\"#d91820\");\n6\nlabel(\"Zhubei 竹北\");circle(\"#d91820\");\n5\nlabel(\"North Hsinchu 北新竹\");circle(\"#000000\");\nlt(90);\nfd(4);label(\"Qianjia 千甲\");circle();\nfd(4);label(\"Xinzhuang 新莊\");circle();\nfd(3);label(\"Zhuzhong 竹中\");circle(\"#000000\");\nlt(90);\nfd(5);\npu();\ndashedLine();\nfd(4);\nlt(90);\nfd(5);\nlt(90);\nfd(7);\nrt(90);\nfd(2);\nrt(90);\nfd(3);\nlt(90);\nfd(4);\npu();\nbk(4);\nrt(90);\nbk(3);\nlt(90);\nbk(2);\nlt(90);\nbk(7);\nrt(90);\nbk(5);\nrt(90);\nbk(4);\npd();\nlabel(\"Liujia 六家 <font color='#da5530'>(Hsinchu HSR 新竹高鐵)</font>\");circle(\"#f9bd93\");\nbk(5);\nrt(90);\nfd(4);label(\"Shangyuan 上員\");circle();\nfd(6);label(\"Ronghua 榮華\");circle();\nfd(4);label(\"Zhudong 竹東\");circle();\nfd(5);label(\"Hengshan 橫山\");circle();\nfd(4);label(\"Jiuzantou 九讚頭\");circle();\nfd(4);label(\"Hexing 合興\");circle();\nfd(3);label(\"Fugui 富貴\");circle();\nfd(5);label(\"Neiwan 內灣\");circle();\nbk(46);\nrt(90);\n4\nlabel(\"<b>Hsinchu 新竹</b>\");circle(\"#d91820\");\n4\nSanxingqiao 三姓橋\n4\nXiangshan 香山\n6\nQiding 崎頂\n6\nlabel(\"Zhunan 竹南\");halfCircleTop(\"#d91820\");halfCircleBottom(\"#000000\");\nlt(90);\nfd(6);label(\"Tanwen 談文\");circle();\nfd(3);rt(90);fd(6);\nbk(6);\nlt(90);\nbk(9);\nrt(90);\n5\nZaoqiao 造橋\n5\nlt(90);\npu();\ndashedLine();\nfd(4);\nrt(90);\nfd(5);\nrt(90);\nfd(4);\npu();\nbk(4);\nlt(90);\nbk(5);\nlt(90);\nbk(4);\nrt(90);\npd();\nlabel(\"<font color='#da5530'>(Miaoli HSR 苗栗高鐵)</font> Fengfu 豐富\");circle(\"#f9bd93\");\n5\nlabel(\"Miaoli 苗栗\");circle(\"#d91820\");\n7\nNanshi 南勢\n5\nTongluo 銅鑼\n7\nSanyi 三義\n8\nTaian 泰安\n4\nlabel(\"Houli 后里\");circle(\"#d91820\");\n8\nlabel(\"Fengyuan 豐原\");circle(\"#d91820\");\n6\nTanzi 潭子\n5\nTaiyuan 太原\nfd(4);label(\"<b>Taichung 臺中</b>\");fd(1);circle(\"#d91820\");\nfd(3);label(\"Daqing 大慶\");fd(1);circle();\nfd(2);label(\"Wuri 烏日\");fd(1);circle();\n2\nlabel(\"<font color='#da5530'>(Taichung HSR 台中高鐵)</font> Xinwuri 新烏日\");halfCircleTop(\"#f9bd93\");halfCircleBottom(\"#d91820\");\n4\nlabel(\"Chenggong 成功\");circle(\"#000000\");\nlt(90);\nfd(4);label(\"Zhuifen 追分\");circle();\nfd(5);lt(90);fd(2);label(\"Dadu 大肚\");circle(\"#d91820\");\nfd(6);label(\"Longjing 龍井\");circle();\nfd(6);label(\"Shalu 沙鹿\");circle(\"#d91820\");\nfd(5);label(\"Qingshui 清水\");circle(\"#d91820\");\nfd(6);label(\"Taichung Port 臺中港\");circle();\nfd(6);label(\"Dajia 大甲\");circle(\"#d91820\");\nfd(6);label(\"Rinan 日南\");circle();\nfd(8);label(\"Yuanli 苑裡\");circle(\"#d91820\");\nfd(7);label(\"Tongxiao 通霄\");circle(\"#d91820\");\nfd(6);label(\"Xinpu 新埔\");circle();\nfd(4);label(\"Baishatun 白沙屯\");circle(\"#d91820\");\nfd(7);label(\"Longgang 龍港\");circle();\nfd(4);label(\"Houlong 後龍\");circle(\"#d91820\");\nfd(4);label(\"Dashan 大山\");circle();\nbk(77);\nrt(90);\nbk(9);\nrt(90);\n8\nlabel(\"Changhua 彰化\");circle(\"#d91820\");\n7\nHuatan 花壇\n4\nDacun 大村\n4\nlabel(\"Yuanlin 員林\");circle(\"#d91820\");\n4\nYongjing 永靖\n4\nlabel(\"Shetou 社頭\");circle(\"#d91820\");\n5\nlt(90);\npu();\ndashedLine();\nfd(30);\nlt(90);\nlabel(\"<font color='#da5530'>Changhua HSR 彰化高鐵</font>\");circle(\"#f9bd93\");\nrt(90);\npu();\nbk(30);\nrt(90);\npd();\nlabel(\"Tianzhong 田中\");circle(\"#d91820\");\n19\nlabel(\"Ershui 二水\");halfCircleBottom(\"#000000\");halfCircleTop(\"#d91820\");\nlt(90);\nfd(4);label(\"Yuanquan 源泉\");circle();\nfd(9);label(\"Zhuoshui 濁水\");circle();\nfd(7);label(\"Longquan 龍泉\");circle();\nfd(7);label(\"Jiji 集集\");circle();\nfd(11);label(\"Shuili 水里\");circle();\nfd(5);label(\"Checheng 車埕\");circle();\nbk(43);\nrt(90);\n7\nlabel(\"Linnei 林內\");circle(\"#d91820\");\n4\nShiliu 石榴\n5\nlabel(\"Douliu 斗六\");circle(\"#d91820\");\n8\nlt(90);\npu();\ndashedLine();\nfd(15);\nrt(90);\nfd(15);\nlt(90);\nfd(15);\nlt(90);\nlabel(\"<font color='#da5530'>Yunlin HSR 雲林高鐵</font>\");circle(\"#f9bd93\");\npu();\nrt(90);\nbk(15);\nrt(90);\nbk(15);\nlt(90);\nbk(15);\nrt(90);\npd();\nlabel(\"Dounan 斗南\");circle(\"#d91820\");\n4\nShigui 石龜\n5\nlabel(\"Dalin 大林\");circle(\"#d91820\");\n6\nlabel(\"Minxiong 民雄\");circle(\"#d91820\");\n5\nJiabei 嘉北\n4\nlt(90);\npu();\ndashedLine();\nfd(30);\nlt(90);\nlabel(\"<font color='#da5530'>Chiayi HSR 嘉義高鐵</font>\");circle(\"#f9bd93\");\nrt(90);\npu();\nbk(30);\nrt(90);\npd();\nlabel(\"Chiayi 嘉義\");circle(\"#d91820\");\n6\nShuishang 水上\n4\nNanjing 南靖\n6\nHoubi 後壁\n7\nlabel(\"Xinying 新營\");circle(\"#d91820\");\n4\nLiuying 柳營\n5\nLinfengying 林鳳營\n6\nlabel(\"Longtian 隆田\");circle(\"#d91820\");\n3\nBalin 拔林\n4\nlabel(\"Shanhua 善化\");circle(\"#d91820\");\n3\nNanke 南科\n4\nlabel(\"Xinshi 新市\");circle(\"#d91820\");\nfd(3);\nlt(90);\nfd(3);\nlabel(\"Yongkang 永康\");circle(\"#d91820\");\n4\nDaqiao 大橋\n4\nlabel(\"<b>Tainan 臺南</b>\");circle(\"#d91820\");\n8\nBaoan 保安\n3\nRende 仁德\n4\nlabel(\"Zhongzhou 中洲\");circle(\"#000000\");\nlt(90);\nfd(4);label(\"Chang Jung Christian University 長榮大學\");circle();\nfd(5);\nlt(90);\npu();\ndashedLine();\nfd(7);\nlt(90);\nfd(9);\ncircle();\npu();\nbk(9);\nrt(90);\nbk(7);\nrt(90);\ndashedLine();\nfd(16);\nlt(90);\nfd(19);\nlt(90);\nfd(25);\ncircle();\npu();\nbk(25);\nrt(90);\nbk(19);\nrt(90);\nbk(16);\nlabel(\"Shalun 沙崙 <font color='#da5530'>(Tainan HSR 台南高鐵)</font>\");circle(\"#f9bd93\");\nbk(9);\nrt(90);\npd();\n5\nlabel(\"Dahu 大湖\");circle(\"#d91820\");\n4\nlabel(\"Luzhu 路竹\");circle(\"#d91820\");\nfd(8);\nlabel(\"Gangshan 岡山\");\nfd(1);\ncircle(\"#d91820\");\nfd(2);\nlabel(\"<font color='#1896dc'>(Ciaotou Sugar Refinery MRT)</font>\");\nfd(3);\nlabel(\"Qiaotou 橋頭 <font color='#1896dc'>捷運</font>\");circle(\"#1896dc\");\n3\nlabel(\"Nanzi 楠梓\");circle(\"#d91820\");\n4\nlabel(\"<font color='#da5530'>(Zuoying HSR</font> <font color='#1896dc'>MRT</font><font color='#da5530'> 左營高鐵</font> <font color='#1896dc'>捷運</font><font color='#da5530'>)</font>\");\n2\nfd(1);label(\"Xinzuoying 新左營\");bk(1);thirdCircleRight(\"#f9bd93\");thirdCircleBottom(\"#1896dc\");thirdCircleLeft(\"#d91820\");\n4\nfd(1);label(\"Zuoying 左營\");bk(1);circle();\n9\nlabel(\"<b>Kaohsiung 高雄</b> <font color='#1896dc'>MRT 捷運</font>\");halfCircleTop(\"#1896dc\");halfCircleBottom(\"#d91820\");\n8\nlabel(\"Fengshan 鳳山\");circle(\"#d91820\");\n3\nHouzhuang 後庄\n5\nlabel(\"Jiuqutang 九曲堂\");circle(\"#d91820\");\n5\nLiukuaicuo 六塊厝\n4\nlabel(\"Pingtung 屏東\");circle(\"#d91820\");\n3\nGuilai 歸來\n3\nLinluo 麟洛\n3\nlabel(\"Xishi 西勢\");circle(\"#d91820\");\n4\nZhutian 竹田\n19\nlabel(\"Chaozhou 潮州\");circle(\"#d91820\");\n6\nKanding 崁頂\n6\nlabel(\"Nanzhou 南州\");circle(\"#d91820\");\n5\nZhenan 鎮安\n6\nlabel(\"Linbian 林邊\");circle(\"#d91820\");\n6\nJiadong 佳冬\n6\nDonghai 東海\n7\nlabel(\"Fangliao 枋寮\");circle(\"#d91820\");\n7\nJialu 加祿\n5\nNeishi 內獅\n6\nFangshan 枋山\n32\nGuzhuang 古莊\n5\nlabel(\"Dawu 大武\");circle(\"#d91820\");\n12\nlabel(\"Longxi 瀧溪\");circle(\"#d91820\");\nfd(7);\nlt(90);\nfd(3);\nlabel(\"Jinlun 金崙\");circle(\"#d91820\");\n12\nlabel(\"Taimali 太麻里\");circle(\"#d91820\");\n12\nlabel(\"Zhiben 知本\");circle(\"#d91820\");\n10\nlabel(\"Kangle 康樂\");circle(\"#d91820\");\n7\nlabel(\"<b>Taitung 臺東</b>\");circle(\"#d91820\");\n9\nShanli 山里\n7\nlabel(\"Luye 鹿野\");circle(\"#d91820\");\n7\nlabel(\"Ruiyuan 瑞源\");circle(\"#d91820\");\n4\nRuihe 瑞和\n8\nlabel(\"Guanshan 關山\");circle(\"#d91820\");\n9\nHaiduan 海端\n8\nlabel(\"Chishang 池上\");circle(\"#d91820\");\n8\nlabel(\"Fuli 富里\");circle(\"#d91820\");\n7\nlabel(\"Dongzhu 東竹\");circle(\"#d91820\");\n7\nlabel(\"Dongli 東里\");circle(\"#d91820\");\n8\nlabel(\"Yuli 玉里\");circle(\"#d91820\");\n11\nSanmin 三民\n14\nlabel(\"Ruisui 瑞穗\");circle(\"#d91820\");\n10\nlabel(\"Fuyuan 富源\");circle(\"#d91820\");\n4\nDafu 大富\n8\nlabel(\"Guangfu 光復\");circle(\"#d91820\");\n7\nlabel(\"Wanrong 萬榮\");circle(\"#d91820\");\n8\nlabel(\"Fenglin 鳳林\");circle(\"#d91820\");\n6\nNanping 南平\n8\nlabel(\"Fengtian 豐田\");circle(\"#d91820\");\n5\nlabel(\"Shoufeng 壽豐\");circle(\"#d91820\");\n3\nPinghe 平和\n5\nlabel(\"Zhixue 志學\");circle(\"#d91820\");\n11\nlabel(\"Jian 吉安\");circle(\"#d91820\");\n6\nlabel(\"Hualien 花蓮\");circle(\"#d91820\");\n6\nlabel(\"Beipu 北埔\");circle(\"#d91820\");\n5\nJingmei 景美\n5\nlabel(\"Xincheng 新城\");circle(\"#d91820\");\n4\nChongde 崇德\n8\nlabel(\"Heren 和仁\");circle(\"#d91820\");\n8\nlabel(\"Heping 和平\");circle(\"#d91820\");\n5\nHanben 漢本\n9\nWuta 武塔\n4\nlabel(\"Nanao 南澳\");circle(\"#d91820\");\n8\nlabel(\"Dongao 東澳\");circle(\"#d91820\");\n6\nlt(90);\nYongle 永樂\n6\nlabel(\"Suaoxin 蘇澳新\");halfCircleBottom(\"#000000\");halfCircleTop(\"#d91820\");\nlt(90);\nfd(5);label(\"Suao 蘇澳\");circle(\"#d91820\");\nbk(5);\nrt(90);\n2\ncircle();\nfd(1);\nlabel(\"Xinma 新馬\");\nfd(4);\nlabel(\"Dongshan 冬山\");circle(\"#d91820\");\n7\nlabel(\"Luodong 羅東\");circle(\"#d91820\");\n3\nZhonglǐ 中里\n2\ncircle();\nfd(1);\nlabel(\"Erjie 二結\");\nfd(5);\nlabel(\"Yilan 宜蘭\");circle(\"#d91820\");\n4\nSicheng 四城\n5\nlabel(\"Jiaoxi 礁溪\");circle(\"#d91820\");\n5\nDingpu 頂埔\n4\nlabel(\"Toucheng 頭城\");circle(\"#d91820\");\n4\nWaiao 外澳\n5\nGuishan 龜山\n5\nDaxi 大溪\n6\nDali 大里\n4\nShicheng 石城\n6\nlabel(\"Fulong 福隆\");circle(\"#d91820\");\n5\nlabel(\"Gongliao 貢寮\");circle(\"#d91820\");\n7\nlabel(\"Shuangxi 雙溪\");circle(\"#d91820\");\n5\nMudan 牡丹\n5\nlabel(\"Sandiaoling 三貂嶺\");circle(\"#000000\");\nlt(90);\nfd(8);rt(180);label(\"Dahua 大華\");circle();lt(180);\nfd(7);rt(180);label(\"Shifen 十分\");circle();lt(180);\nfd(4);rt(180);label(\"Wanggu 望古\");circle();lt(180);\nfd(5);rt(180);fd(1);label(\"Lingjiao 嶺腳\");bk(1);circle();lt(180);\nfd(3);rt(180);label(\"Pingxi 平溪\");circle();lt(180);\nfd(4);rt(180);label(\"Jingtong 菁桐\");circle();lt(180);\nbk(31);\nrt(90);\n5\nlabel(\"sHoutong 猴硐\");circle(\"#d91820\");\n7\nlt(90);\nfd(10);\npu();\nfd(1);label(\"Haikeguan\");bk(1);\nfd(5);label(\"(NMMST) 海科館\");bk(5);\npd();\ncircle();\nbk(10);\nrt(90);\nlabel(\"Ruifang 瑞芳\");circle(\"#d91820\");\n7\nSijiaoting 四腳亭\n4\nNuannuan 暖暖\n9\nlt(90);\npu();\nfd(60);\nrt(90);\nfd(50);\npd();\nrt(90);\nlabel(\"<img src=\\\"images/tra.png\\\">\");\npu();bk(155);lt(90);bk(25);rt(90);pd();\nlabel(\"<font size=96px><b>TRA Map 臺鐵地圖</b></font>\");\npu();bk(20);pd();\nlabel(\"Peter Burkimsher 林台平\");\npu();bk(5);pd();\nlabel(\"2016-10-28\");\npu();bk(8);pd();\ncircle(\"#000000\");pu();fd(1);rt(90);fd(1);lt(90);pd();label(\"Transfer station 轉乘站\");pu();rt(90);bk(1);lt(90);bk(1);\nbk(5);pd();\ncircle(\"#d91820\");pu();fd(1);rt(90);fd(1);lt(90);pd();label(\"Express 莒光\");pu();rt(90);bk(1);lt(90);bk(1);\nbk(5);pd();\ncircle(\"#f9bd93\");pu();fd(1);rt(90);fd(1);lt(90);pd();label(\"HSR 高鐵\");pu();rt(90);bk(1);lt(90);bk(1);\nbk(5);pd();\ncircle(\"#1896dc\");pu();fd(1);rt(90);fd(1);lt(90);pd();label(\"MRT 捷運\");pu();rt(90);bk(1);lt(90);bk(1);\nbk(5);rt(90);bk(7);\ndashedLine();\nfd(7);\npu();\nlt(90);\npu();fd(1);rt(90);fd(1);lt(90);pd();label(\"HSR shuttle bus 高鐵快捷公車\");pu();rt(90);bk(1);lt(90);bk(1);";
			
			jsCodeArea.value = "lt(90);\nfor (var currentStation=0;currentStation<=662;currentStation++)\n{\nvar thisStation = localStorage[\"A\"+currentStation];\n\nif (isNumeric(thisStation))\n{\nfd(thisStation);\n} else {\nif (contains(thisStation, ';'))\n{\neval(thisStation);\n} else {\nlabel(thisStation);\ncircle();\n} // end if this cell is a JS command\n} // end if this cell is a number\n} // end for every row\n";
			
			document.getElementById("numberRowsField").value = "365";
			setRows();
						
			document.getElementById("numberColumnsField").value = "20";
			setColumns();
			
			resizeDrawing("2000px", "2000px");

			//importSheet();
			cg();
			lt(90);
			for (var currentStation=1;currentStation<=662;currentStation++)
			{
				var thisStation = localStorage["A"+currentStation];
				
				if (isNumeric(thisStation))
				{
					fd(thisStation);
				} else {
					if (contains(thisStation, ';'))
					{
						eval(thisStation);
					} else {
						label(thisStation);
					circle();
					} // end if this cell is a JS command
				} // end if this cell is a number
			} // end for every row
			
			drawing.setZoom(2);
			drawing.panTo(new L.LatLng(-200, 50));

			ht();
		} // end function railway
		
	</script>

	
</body>
</html>
